---
title: "Premier League 2023/2024: Newcastle United FC"
output: 
  flexdashboard::flex_dashboard:
    theme:
      bg: "#000"
      fg: "#41B6E6" 
      primary: "#FFF"
    orientation: columns
    vertical_layout: scroll
    social: [twitter, linkedin]
    favicon: IMG_20240908_223832.jpg
    
---

```{r ,global_options, include=FALSE}
library(knitr)
opts_chunk$set(message=FALSE, warning=FALSE, tidy.opts = list(width.cutoff=60))
suppressPackageStartupMessages(library(ggthemes))
suppressPackageStartupMessages(library(plotly))
suppressPackageStartupMessages(library(tidyverse))
suppressPackageStartupMessages(library(shiny))
suppressPackageStartupMessages(library(flexdashboard))
suppressPackageStartupMessages(library(pander))
suppressPackageStartupMessages(library(DT))
suppressPackageStartupMessages(library(ggvis))
suppressPackageStartupMessages(library(viridis))
suppressPackageStartupMessages(library(readxl))
suppressPackageStartupMessages(library(ggplotlyExtra))

epl=data.frame(read.csv("matches.csv", header=TRUE))
new<-epl[epl$Team=="NewcastleUnited",]
```

Introduction
=============================================================

Column
---------------------------------------------------------------

Newcastle United FC is a professional football club based in Tynneside, England. The team took part in the 2023/24 Premier League season and managed a 7th place finish under Eddie Howe. The Magpies did not qualify for any of next season's European competitions. However, their run in this season's Champions League will be one to remember. This dashboard looks at the club's on-the-pitch performance in the English top flight division. 

### Eddie Howe

![](C:\Users\Admin\Desktop\gift\statistical computing\IMG_20240909_164138.jpg)



Column
---------------------------------------------------------------
### 

![](C://Users//Admin//Desktop//gift//statistical computing//IMG_20240909_163939.jpg)


### 

![](C://Users//Admin//Desktop//gift//statistical computing//IMG_20240909_163953.jpg)



Players {data-orientation="rows"}
===========================================================

Row
------------------------------------------------------------
```{r}
## PLAYERS' DATASET
sheets<-excel_sheets("Soccer-Stats-Premier-League-2023-2024_Final_20240610.xlsx")
players<-data.frame(read_excel("Soccer-Stats-Premier-League-2023-2024_Final_20240610.xlsx",
                               sheet = sheets[4]))

# dim(players) # 746 rows by 27 columns
# Checking for duplicates  
# players[duplicated(players), ]  # No duplicates found
# Checking for missing values
# players[!complete.cases(players), ] # 572 cases with NAs  
#players<-players[complete.cases(players), ]# 487 complete cases
players1<-players[,c(2,7,9,10,12,20,23,24,25,26)]

# DATA TYPE CONVERTION
players1$Name<-factor(players1$Name)
players1$Team<-factor(players1$Team)
players1$Position<-factor(players1$Position)
```

### Registered players

```{r}
players %>% 
  filter(Team == "Newcastle United") %>% 
  count() %>% 
  valueBox(color="#41B6E6")
```

### Goalkeepers

```{r}
players %>% 
  filter(Team == "Newcastle United",
         Position == "Goalkeeper") %>% 
  count() %>% 
  valueBox(color="#41B6E6")
```

### Defenders

```{r}
players %>% 
  filter(Team == "Newcastle United",
         Position == "Defender") %>% 
  count() %>% 
  valueBox(color = "#41B6E6")
```

### Midfielders

```{r}
players %>% 
  filter(Team == "Newcastle United",
         Position == "Midfielder") %>% 
  count() %>% 
  valueBox(color="#41B6E6")
```

### Forwards

```{r}
players %>% 
  filter(Team == "Newcastle United",
         Position == "Forward") %>% 
  count() %>% 
  valueBox(color="#41B6E6")
```

### Average age (years)

```{r}
players %>% 
  filter(Team == "Newcastle United") %>% 
  summarise(round(mean(Age),0)) %>% 
  valueBox(color="#41B6E6")
```

Row {.tabset .tabset-fade}
----------------------------------------------------------------

### Goalkeepers

```{r}
players %>% 
  filter(Team == "Newcastle United",
         Position == "Goalkeeper") %>% 
  select(Citizenship, Name, Jersey) %>% 
  pander()
```

### Defenders

```{r}
players %>% 
  filter(Team == "Newcastle United",
         Position == "Defender") %>% 
  select(Citizenship, Name, Jersey) %>% 
  pander()
```

### Midfielders

```{r}
players %>% 
  filter(Team == "Newcastle United",
         Position == "Midfielder") %>% 
  select(Citizenship, Name, Jersey) %>% 
  pander()
```

### Forwards

```{r}
players %>% 
  filter(Team == "Newcastle United",
         Position == "Forward") %>% 
  select(Citizenship, Name, Jersey) %>% 
  pander()
```


Outcomes
=========================================================

Column
-------------------------------------------------------
### Home


```{r}
cat("Wins","[%]")
#new %>% 
  #filter(Venue == "Home" & Result=="W") %>% 
  #summarise(win.pct.h=n()*100/19) %>% 
  gauge(63.15, min=0,max=100,symbol="%",
        gaugeSectors(success = c(80,100),
                     warning =c(40,79),
                     danger = c(0,39)))

```

### 

```{r}
cat("Draws","[%]")
#new %>% 
  #filter(Venue == "Home" & Result=="D") %>% 
  #summarise(draw.pct.h=n()*100/19) %>% 
  gauge(21.05, min=0,max=100,symbol="%")

```

### 

```{r}
cat("Losses","[%]")
#new %>% 
  #filter(Venue == "Home" & Result=="L") %>% 
  #summarise(loss.pct.h=n()*100/19) %>% 
  gauge(15.78, min=0,max=100,symbol="%",
        gaugeSectors(success = c(0,39),
                     warning =c(40,79),
                     danger = c(80,100)))

```

Column
-------------------------------------------------------
### Away


```{r}
cat("Wins","[%]")
#new %>% 
  #filter(Venue == "Away" & Result=="W") %>% 
  #summarise(win.pct.a=n()*100/19) %>% 
  gauge(31.58, min=0,max=100,symbol="%",
        gaugeSectors(success = c(80,100),
                     warning =c(40,79),
                     danger = c(0,39)))

```

### 

```{r}
cat("Draws","[%]")
#new %>% 
  #filter(Venue == "Away" & Result=="D") %>% 
  #summarise(draw.pct.a=n()*100/19) %>% 
  gauge(10.53, min=0,max=100,symbol="%")

```

### 

```{r}
cat("Losses","[%]")
#new %>% 
  #filter(Venue == "Away" & Result=="L") %>% 
  #summarise(loss.pct.a=n()*100/19) %>% 
  gauge(57.89, min=0,max=100,symbol="%",
        gaugeSectors(success = c(0,39),
                     warning =c(40,79),
                     danger = c(80,100)))

```


Awards
===========================================================

Column
------------------------------------------------------------
### Goals scored

```{r, fig.align="top", out.width="10%"}
include_graphics(
"C://Users//Admin//Desktop//gift//statistical computing//IMG_20240908_224316.jpg")
```

### 
```{r}
players1 %>%
  filter(Team == "Newcastle United",
         totalGoals >= 1) %>% 
  select(Name, totalGoals) %>%
  arrange(desc(totalGoals)) %>% 
  pander()
  
```

Column
------------------------------------------------------------
### Goal Assists

```{r, fig.align="top", out.width="10%"}
include_graphics(
"C://Users//Admin//Desktop//gift//statistical computing//IMG_20240908_224451.jpg")
```

###

```{r, fig.align="top"}
include_graphics(
"C://Users//Admin//Desktop//gift//statistical computing//IMG_20240908_224041.jpg")
```

###
```{r}
players1 %>%
  filter(Team == "Newcastle United",
         goalAssists >= 1) %>% 
  select(Name, goalAssists) %>%
  arrange(desc(goalAssists)) %>% 
  pander()
  
```


St.James' Park
===========================================================

Column 
-----------------------------------------------------------
### 

```{r, fig.align="top", out.width="40%"}
include_graphics(
"C://Users//Admin//Desktop//gift//statistical computing//IMG_20240909_163731.jpg")
```

### 

```{r, fig.align="bottom", out.width="20%"}
include_graphics(
"C://Users//Admin//Desktop//gift//statistical computing//IMG_20240909_163532.jpg")
```


Column {.tabset .tabset-fade}
----------------------------------------------------------------------

### Notes

St.James' Park played host to 19 Premier League home games over the 2023/24 campaign. The average match attendance stands at **52,125**.

The highest attendance was recorded in **April 2024** against **Chelsea** (full attendance) and the lowest at **51,670** against **Brentford** in **September of 2023**.


### Home matches

```{r}
new.home<-
  new[new$Venue == "Home",]%>% 
  select(c(Round,Opponent,Attendance)) %>% 
  arrange(desc(Attendance)) %>%
  mutate(percent =   round(Attendance*100/(52227),2))%>%
  datatable(rownames=FALSE); new.home  
```

### Distribution

```{r}
new.at.home<-new[new$Venue=="Home", ]
new.attendance<-ggplot(new.at.home, aes(x=Date,y=Attendance))+
  geom_point(shape=20, size=4, color="#41B6E6", alpha=0.85)+
  geom_hline(aes(yintercept=round(mean(Attendance),0)))+
  theme(axis.text.x = element_text(angle=45, hjust=1))+
  labs(x="Time",
       y="Attendance",
       title="Premier League\nhome attendance: St.James' Park 2023/24")+
  theme_pander()

plotly::ggplotly(p=new.attendance)
```

Goals scored {data-navmenu="Offensive record"}
======================================================================

```{r , fig.width=14, fig.height=5}
offensive1<-epl %>% 
  group_by(Team) %>% 
  summarise(goals_scored = sum(GF)) %>% 
  arrange(desc(goals_scored)) %>% 
  head(10)  

GS<-ggplot(offensive1,aes(x=reorder(Team, goals_scored), y=goals_scored))+
  geom_bar(stat='identity',fill = "#41B6E6", alpha=0.85)+
  theme(axis.text.x = element_text(angle=45, hjust=1))+
 labs(x="Teams",
      y="Goals scored",
      title="Goals scored:\nPremier League 2023/2024",
      subtitle = "Top 10")+
  theme_pander()

ggplotly(GS)
```


Column
----------------------------------------------------------------------

### Position

```{r,fig.width=4}
epl %>% 
  group_by(Team) %>% 
  summarise(total.goals = sum(GF)) %>%
  arrange(desc(total.goals)) %>% 
  mutate(position = min_rank(-total.goals)) %>% 
  filter(Team == "NewcastleUnited") %>% 
  select(position) %>%
  valueBox(color="#41B6E6")
```

### Goals scored

```{r,fig.width=4}
valueBox(value=sum(new$GF),color="#41B6E6")
```


Column
-------------------------------------------------------------------------

### Home Goals

```{r, fig.width=4}

valueBox(value = sum(new.at.home$GF),color="#41B6E6")
```

### Away Goals

```{r, fig.width=4}
valueBox(value=sum(new$GF)-sum(new.at.home$GF),color="#41B6E6")
```



Shots {data-navmenu="Offensive record"}
=======================================================

```{r ,fig.width=14, fig.height=5}
offensive2<-epl %>% 
  group_by(Team) %>%
  summarise(Shot_accuracy = sum(SoT)*100/sum(Sh)) %>% 
  arrange(desc(Shot_accuracy)) %>% 
  head(10) 

SOT<-ggplot(offensive2 ,aes(x=reorder(Team, Shot_accuracy), y=Shot_accuracy))+
  geom_bar(stat='identity',fill = "#41B6E6", alpha=0.85)+
  theme_pander()+
  theme(axis.text.x = element_text(angle=45, hjust=1))+
  labs(x="Teams",
       y="Percentage",
       title="Shot accuracy [%]:\nPremier League 2023/2024")

ggplotly(SOT)
```

Column
----------------------------------------------------------------------

### Position

```{r,fig.width=4}
epl %>% 
  group_by(Team) %>% 
  summarise(shot.acc = sum(SoT)*100/sum(Sh)) %>%
  arrange(desc(shot.acc)) %>% 
  mutate(position = min_rank(-shot.acc)) %>% 
  filter(Team == "NewcastleUnited") %>% 
  select(position) %>%
valueBox(color="#41B6E6")
```

### Shot accuracy [%]

```{r,fig.width=4}
valueBox(value=round(sum(new$SoT)*100/sum(new$Sh), 2)
, color="#41B6E6")
```

Possession {data-navmenu="Offensive record"}
=======================================================

```{r ,fig.width=14, fig.height=5}
offensive3<-epl %>% 
  group_by(Team) %>%
  summarise(avg.poss = mean(Poss)) %>% 
  arrange(desc(avg.poss)) %>% 
  head(10)  

POSS<-ggplot(offensive3, aes(x=reorder(Team, avg.poss), y=avg.poss))+
  geom_bar(stat='identity',fill = "#41B6E6", alpha=0.85)+
  theme_pander()+
  theme(axis.text.x = element_text(angle=45, hjust=1))+
  labs(x="Teams",
       y="Percentage",
       title="Average ball possession [%]:\nPremier League 2023/2024",
       subtitle = "Top 10")

ggplotly(POSS)
```

Column
----------------------------------------------------------------------

### Position

```{r,fig.width=4}
epl %>% 
  group_by(Team) %>% 
  summarise(avg.poss = mean(Poss)) %>%
  arrange(desc(avg.poss)) %>% 
  mutate(position = min_rank(-avg.poss)) %>% 
  filter(Team == "NewcastleUnited") %>% 
  select(position) %>%
valueBox(color="#41B6E6")
```

### Average possesion [%]

```{r,fig.width=4}
valueBox(value=round(mean(new$Poss), 2)
, color="#41B6E6")
```

# Goals conceded {data-navmenu="Defensive record"}

```{r ,fig.width=14, fig.height=5}
defensive1<-epl %>% 
  group_by(Team) %>%
  summarise(gc = sum(GA)) %>% 
  arrange(gc) %>% 
  head(20) 
CONC<-ggplot(defensive1, aes(x=reorder(Team, gc), y=gc))+
  geom_bar(stat='identity', fill = "#41B6E6", alpha=0.85)+
  theme_pander()+
  theme(axis.text.x = element_text(angle=45, hjust=1))+
  labs(x="Teams",
       y="goals",
       title="Goals conceded:\nPremier League 2023/2024",
       subtitle = "Top 10:Least conceded goals")

ggplotly(CONC)
```

Column
----------------------------------------------------------------------

### Position

```{r,fig.width=4}
epl %>% 
  group_by(Team) %>% 
  summarise(g.c = sum(GA)) %>%
  arrange(desc(g.c)) %>% 
  mutate(position = min_rank(g.c)) %>% 
  filter(Team == "NewcastleUnited") %>% 
  select(position) %>%
valueBox(color="#41B6E6")
```

### Goals conceded

```{r,fig.width=4}
valueBox(value=sum(new$GA), color="#41B6E6")
```

Column
----------------------------------------------------------------------

### At Home

```{r, fig.width=4}

valueBox(value = sum(new.at.home$GA), 
         color="#41B6E6")
```

### Away

```{r, fig.width=4}
valueBox(value=sum(new$GA)-sum(new.at.home$GA), 
         color="#41B6E6")
```

# Clean sheets {data-navmenu="Defensive record"}

```{r,fig.width=14, fig.height=5}
defensive2<-epl[epl$GA == 0, ] %>% 
  group_by(Team) %>% 
  count() %>% 
  arrange(desc(n)) %>% 
  head(10)
  
CS<-ggplot(defensive2,aes(x=reorder(Team, n), y=n))+
  geom_bar(stat='identity', fill = "#41B6E6", alpha=0.85)+
  theme_pander()+
  theme(axis.text.x = element_text(angle=45, hjust=1))+
  labs(x="Teams",
       y="Frequency",
       title="Clean sheets:\nPremier League 2023/2024") 

ggplotly(CS)
```

Column
----------------------------------------------------------------------

### Position

```{r}
epl[epl$GA == 0, ] %>% 
  group_by(Team) %>% 
  summarise(c.s = n()) %>%
  mutate(position = min_rank(-c.s)) %>%
  arrange(desc(c.s)) %>% 
  filter(Team == "NewcastleUnited") %>% 
  select(position) %>%
valueBox(color="#41B6E6")
```

### Clean sheets

```{r}
new[new$GA==0,] %>% 
  count() %>% 
  valueBox(color="#41B6E6")
```

Column
----------------------------------------------------------------------

### At home

```{r}
new[new$Venue == "Home",] %>%
  filter(GA == 0) %>% 
  nrow() %>% 
valueBox(color="#41B6E6")
```

### Away

```{r}
# 10-8=2
new[new$Venue == "Away",] %>%
  filter(GA == 0) %>% 
  nrow() %>% 
valueBox(color="#41B6E6")
```


References
============================================================

- [www.kaggle.com/datasets/mertbayraktar/english-premier-league-matches-20232024-season](www.kaggle.com/datasets/mertbayraktar/english-premier-league-matches-20232024-season)

- [https://pkgs.rstudio.com/flexdashboard/](https://pkgs.rstudio.com/flexdashboard/)

- [https://www.excel4soccer.com/
](https://www.excel4soccer.com/
)